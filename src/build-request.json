{
  "kind": "build_request",
  "title": "Rewrite Motoko backend to compile in production by removing all mo:core usage",
  "projectName": "CupCakeMC Store",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-4",
      "text": "Rewrite `backend/main.mo` to remove all `mo:core/*` imports and use only `mo:base/*` modules (and Motoko built-ins), so the backend compiles in production.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1",
          "msg-2"
        ],
        "quotes": [
          "rewrite backend now using mo:base only",
          "rewrite backend now"
        ]
      },
      "acceptanceCriteria": [
        "`backend/main.mo` contains no imports starting with `mo:core/`.",
        "Project builds successfully for production without the 'mo:core imports' compilation failure."
      ]
    },
    {
      "id": "REQ-5",
      "text": "Replace all logic currently relying on `mo:core`-specific data structures/APIs in `backend/main.mo` with `mo:base` equivalents while preserving the existing public Candid interface and behavior for: user profiles, shop items CRUD, cart operations, UPI purchases, orders listing, and order approval.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "I will now rewrite your backend using only mo:base imports so production can compile successfully."
        ]
      },
      "acceptanceCriteria": [
        "All existing public methods in `backend/main.mo` remain available with the same names, parameters, and return types (no breaking Candid changes).",
        "Behavior is preserved for: `getCallerUserProfile`, `getUserProfile`, `saveCallerUserProfile`, `registerWithMinecraftUsername`, `updateUserMinecraftUsername`, `addShopItem`, `editShopItem`, `deleteShopItem`, `getAllShopItems`, `getShopItemsByCategory`, `addToCart`, `getCart`, `clearCart`, `completePurchaseWithUPI`, `getPurchaseHistory`, `getAllOrders`, `approveOrder`, `updateUPIConfig`, `getUPIConfig`, `updateWebsiteConfig`, `getWebsiteConfig`.",
        "All trapping/error paths continue to trap with English error messages (e.g., replace `Runtime.trap` with a production-safe alternative)."
      ]
    },
    {
      "id": "REQ-6",
      "text": "Ensure backend state remains upgrade-safe after migrating away from `mo:core` data structures by implementing stable state serialization + reconstruction in the single `backend/main.mo` actor, initializing defaults when no prior state exists; add `backend/migration.mo` only if required to preserve existing deployed state.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Ensure state remains upgrade-safe after migrating away from `mo:core` data structures by implementing appropriate upgrade handling (stable state serialization + reconstruction) in the single `backend/main.mo` actor, initializing defaults when no prior state exists. Add `backend/migration.mo` only if required to preserve existing deployed state."
        ]
      },
      "acceptanceCriteria": [
        "On upgrade, previously stored values for `upiConfig`, `websiteConfig`, `nextItemId`, profiles, shop items, carts, and purchases are preserved and restored correctly.",
        "On fresh install (no prior stable data), the canister initializes with the current default `upiConfig` and `websiteConfig` values and empty collections.",
        "No new backend actors are introduced; all logic remains in `backend/main.mo` per single-actor constraint.",
        "`backend/migration.mo` is created only if necessary to preserve already-deployed state; otherwise it is not added."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in `backend/main.mo` (no additional backend services).",
    "Do not introduce any `mo:core/*` imports anywhere that is required to compile the backend for production.",
    "Preserve the existing public Candid interface (no breaking API changes).",
    "Use English for any user-facing/trap/error text."
  ],
  "nonGoals": [
    "Adding new product features beyond replacing `mo:core` usage and making the backend compile in production.",
    "Changing frontend UI/UX or routes."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}